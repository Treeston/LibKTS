Welcome to **LibKTS**, a JavaScript library for parsing of Yu-Gi-Oh! tournament files generated by the Konami Tournament Software.<br>
<sup><sub>LibKTS is developed by <a href="https://old.reddit.com/u/gallantron">@gallantron#1059</a>. Need help? Get in touch!</sub></sup>

# Quick Start

Simply include [LibKTS.js](https://github.com/Treeston/LibKTS/blob/main/LibKTS.js) in your project. Then, pass the text contents of the KTS _.tournament_ file to `LibKTS.Parse`.  
A structured object will be returned – see the structure documentation for details.

* <a href="https://libkts-demo.github.io/" target="_blank">Demo application</a> <sub><sup><a href="https://github.com/libkts-demo/libkts-demo.github.io">Source</a></sup></sub>
* [Structure documentation](#struct)
* [Enum documentation](#enum)

<a id="enum"></a>
# Enum fields

`LibKTS.Enum` members contain the constants that are used to represent certain settings in KTS.  

The following applies to all Enum values:

* Enum values used in tournament objects can, and should, be compared for equality (`===`) with these constants.
  * You should _not_ use a value's members for identification.
* All enum values have a suitable toString member for unique internal representation. They can, and should, be used as object keys.
  * You should _not_ use a value's members as object keys.
* To represent an enum value to the user, use the value's `.label` member.
* To represent an enum value to KTS software, use the value's `.code` member.

**✔️ DO:**
```js
if (staffMember.role === LibKTS.Enum.StaffRole.HEAD_JUDGE)
```
```js
eventsByType[tournament.eventType].push(tournament)
```
```js
description.innerText = ('The tournament used the '+tournament.tournamentStyle.label+' format.');
```

**❌ DO __NOT__:**
```js
if (staffMember.role.label === 'Head Judge')
```
```js
eventsByType[tournament.eventType.code].push(tournament)
```
```js
description.innerText = ('The tournament used the '+tournament.tournamentStyle+' format.');
```

<a id="enum-tournamentStyle"></a>
### `Enum.TournamentStyle`

Values are `ADVANCED`, `TRADITIONAL`, `SEALED`, and `OPEN_DUELING`, corresponding to the "Style" tournament setting in KTS.

<a id="enum-tournamentStructure"></a>
### `Enum.TournamentStructure`

Values are `SWISS` and `SINGLE_ELIMINATION`, corresponding to the "Structure" tournament setting in KTS.

<a id="enum-playerStructure"></a>
### `Enum.PlayerStructure`

Values are `INDIVIDUAL`, `TAG_DUEL`, `THREE_VS_THREE`, `FOUR_VS_FOUR`, and `FIVE_VS_FIVE`, corresponding to the "Player Structure" tournament setting in KTS.
To identify how many players a complete team must have, you should use the value's `.teamSize` member.

<a id="enum-eventType"></a>
### `Enum.EventType`

There is a large number of values, matching the "Event Type" tournament setting in KTS.  
Commonly used ones include `LOCAL`, `SNEAK_PEEK`, `WCQ_REGIONAL` and `YUGIOH_DAY`. <sup><sub>(See [`LibKTS.js`](https://github.com/Treeston/LibKTS/blob/main/LibKTS.js) for a full list.)</sub></sup>  
Each value's `.defaultSettings` member has the `{tournamentStyle, tournamentStructure, playerStructure}` tuple that KTS will select by default when the event type is chosen.

<a id="enum-staffRole"></a>
### `Enum.StaffRole`

Values are `TOURNAMENT_ORGANIZER`, `HEAD_JUDGE`, `ASSISTANT_HEAD_JUDGE`, `TEAM_LEAD`, `FLOOR_JUDGE`, `SCOREKEEPER`, `EVENT_MANAGER`, and `EVENT_STAFF`, corresponding to the choices in KTS' staff list.

<a id="struct"></a>
# Object structure documentation

This section documents the objects used to represent tournament information. References to the same logical object (e.g., two references to the same player, or the same match) also reference the same JavaScript object. Objects can, and generally _should_, be compared for strict equality (`===`). 

**✔️ DO:**
```js
if (match.winner === entrant)
```

**❌ DO __NOT__:**
```js
if (match.winner.name === entrant.name)
```

### `Tournament` object

The main entry point object, representing a parsed tournament file. This is what is returned by `KTSLib.Parse`.

A tournament object has the following members:

* `.name` _string_ the tournament name specified in KTS
* `.id` _Object_ the tournament ID specified in KTS
  * `.id.id` _string_ the actual ID (e.g., `X99-124558`), can also be obtained by converting `id` to a string
  * `.id.isTemporary` _bool_ whether this is a temporary ID (generated by KTS) or a unique ID (issued by KCGN)
* `.startTime` _Date_ the tournament's start time, as entered in KTS
* `.eventType` _[Enum.EventType](#enum-eventType)_ the event type set in KTS
* `.tournamentStyle` _[Enum.TournamentStyle](#enum-tournamentStyle)_ the tournament style set in KTS
* `.tournamentStructure` _[Enum.TournamentStructure](#enum-tournamentStructure)_ the tournament structure set in KTS
* `.playerStructure` _[Enum.PlayerStructure](#enum-playerStructure)_ the player structure (i.e., team size settings) set in KTS
* `.staff` _Object_ any staff members entered in KTS
  * `.staff.all` _Array of <code>{ player: [Player](#object-Player), role: [Enum.StaffRole](#enum-staffRole) }</code>_ all staff members
  * <code>.staff.byRole[<a href="#enum-staffRole">Enum.StaffRole</a>]</code> _Array of <code>[Player](#object-Player)</code>_ all players with the given staff role
* `.entrants` _Object_ the participants in the tournament (consisting of one or more players, depending on player structure)
  * `.entrants.all` _Array of <code>[Entrant](#object-Entrant)</code>_ all enrolled entrants
  * `.entrants.active` _Array of <code>[Entrant](#object-Entrant)</code>_ all active entrants (that have not dropped from the tournament)
  * `.entrants.dropped` _Array of <code>[Entrant](#object-Entrant)</code>_ all dropped entrants
  * <code>.entrants.byPlayer[<a href="#object-Player">Player</a>]</code> _[Entrant](#object-Entrant) or undefined_ the tournament entrant for the specified player
  * `.entrants.byKcgnId[string]` _[Entrant](#object-Entrant) or undefined_ the tournament entrant containing a player with the specified KCGN ID
  * `.entrants.byId[string]` _[Entrant](#object-Entrant) or undefined_ the tournament entrant with the specified ID
* `.rounds` _Object_ the tournament's rounds (consisting of one or more matches)
  * `.rounds.all` _Array of <code>[Round](#object-Round)</code>_ all rounds of the tournament
  * `.rounds.current` _[Round](#object-Round) or null_ the current round of the tournament
  * `.rounds.swiss` _Array of <code>[Round](#object-Round)</code>_ all Swiss rounds of the tournament
  * `.rounds.playoff` _Array of <code>[Round](#object-Round)</code>_ all Playoff rounds of the tournament
  * `.rounds.byRoundIdx[int]` _[Round](#object-Round) or undefined_ Round with the specified numeric index
  * `.rounds.firstPlayoffRound` _int or null_ Numeric index of the first playoff round in the tournament
  * `.rounds.byPlayoffPlayers[int]` _[Round](#object-Round) or undefined_ Playoff round with the specified number of players remaining beforehand
* `.matches` _Object_ the tournament's matches (for by-round access, go via `.rounds`)
  * `.matches.all` _Array of <code>[Match](#object-Match)</code>_ all matches in the tournament
  * `.matches.complete` _Array of <code>[Match](#object-Match)</code>_ all matches in the tournament that have a recorded result
  * `.matches.ongoing` _Array of <code>[Match](#object-Match)</code>_ all matches in the tournament that do not have a recorded result
* `.location` _Object <code>{ id, name, address, city, country, phoneNumber, state, webSite, zipCode }</code>_ the tournament location info specified in KTS
* `.isFinalized` _bool_ whether "Finalize Tournament" has been clicked, and the tournament can no longer be edited in KTS
* `.firstTable` _integer_ the first table number used by the tournament (default 1, can be changed in KTS)

<a id="object-Player"></a>
### `Player` object

Represents an individual player. Note that matches are played between _<code>[Entrant](#object-Entrant)</code>s_ consisting of one or more players, not players themselves.

A player object has the following members:

* `.kcgnId` _string or null_ the player's assigned KCGN ID, if provided; `null` for players enrolled with a temporary ID
* `.temporaryId` _string or null_ the temporary ID assigned by KTS, for players without a KCGN ID; not globally unique!
* `.name` _string_ the player's "full name" as displayed in KTS
* `.lastName` _string or null_ the player's last name, as entered in KTS
* `.firstName` _string or null_ the player's first name, as entered in KTS

<a id="object-Entrant"></a>
### `Entrant` object

Represents an entrant into a given tournament.

An entrant object has the following members:

* `.id` _string_ the entrant's ID
* `.name` _string_ the entrant's name
* `.players` _Array of [Player](#object-Player)_ the players that are part of this entrant
* `.rank` _int_ current ranking within the tournament
* `.record` _Object_ the entrant's record in the tournament
  * `.record.swiss` _Object_
    * `.record.swiss.points` _int_ the points achieved in swiss play
    * `.record.swiss.wins` _int_ the number of swiss rounds won
    * `.record.swiss.losses` _int_ the number of swiss rounds lost
    * `.record.swiss.draws` _int_ the number of swiss rounds drawn
    * `.record.swiss.tiebreakers` _[ float, float ]_ the entrant's tiebreaker scores, each between 0 and 1, inclusive
  * `.record.playoff` _Object_
    * `.record.playoff.wins` _int_ the number of playoff rounds won
    * `.record.playoff.losses` _int_ the number of playoff rounds lost
  * `.record.all` _Object <code>{ wins, losses, draws }</code>_ record across both swiss rounds and playoffs
* `.currentMatch` _[Match](#object-Match) or null_ the entrant's ongoing match
* `.matches` _Object_ the matches that the entrant participates in
  * `.matches.all` _Array of <code>[Match](#object-Match)</code>_ all matches the entrant has participated in
  * `.matches.swiss` _Array of <code>[Match](#object-Match)</code>_ all swiss matches the entrant has participated in
  * `.matches.playoff` _Array of <code>[Match](#object-Match)</code>_ all playoff matches the entrant has participated in
  * To get the entrant's match for a specific round, use `.matches.byEntrant` on [Round](#object-Round)
* `.dropped` _Object or null_ non-`null` if and only if the entrant has been dropped from the tournament
  * `.dropped.round` _[Round](#object-Round)_ the round in which the entrant was dropped
  * `.dropped.reason` _string_ the reason for which the entrant was dropped
* `.assignedSeating` _int or null_ fixed table number assigned to this entrant

<a id="object-Match"></a>
### `Match` object

A match object has the following members:

* `.round` _[Round](#object-Round)_
* `.table` _int_ the table this match is played on
* `.isComplete` _bool_ whether a result has been recorded for this match
* `.entrants` _Array [ [Entrant](#object-Entrant) or null, [Entrant](#object-Entrant) or null ]_ the participants in the match
  * `null` participant(s) will be recorded for round byes
* `.winner` _[Entrant](#object-Entrant) or null_ the winner of the match, if determined
* <code>.opponentFor[<a href="#object-Entrant">Entrant</a>]</code> _[Entrant](#object-Entrant) or undefined_ the specified entrant's opponent in this match
* `.resultFor` _Object or undefined_ the result of this complete match from the point of view of a given entrant, `undefined` for incomplete matches
  * <code>.resultFor[<a href="#object-Entrant">Entrant</a>]</code> _string or undefined_ one of the strings `'win'`, `'draw'` or `'loss'`
* `.pointsFor` _Object or undefined_ the points received by any given entrant for this complete swiss match, `undefined` for playoff or incomplete matches
  * <code>.pointsFor[<a href="#object-Entrant">Entrant</a>]</code> _int or undefined_ the points received by the specified entrant for this match


<a id="object-Round"></a>
### `Round` object

A round object has the following members:

* `.idx` _int_ the round's numeric index
* `.label` _string_ text describing the round (e.g., "Round 3" or "Top 32")
* `.isPlayoff` _bool_ whether this round is a playoff round
* `.matches` _Object_ the matches in this round
  * `.matches.all` _Array of <code>[Match](#object-Match)</code>_ all matches in this round
  * `.matches.byTable[int]` _[Match](#object-Match) or undefined_ the match played on the specified table in this round
  * <code>.matches.byEntrant[<a href="#object-Entrant">Entrant</a>]</code> _[Match](#object-Match) or undefined_ the match played by the specified entrant in this round